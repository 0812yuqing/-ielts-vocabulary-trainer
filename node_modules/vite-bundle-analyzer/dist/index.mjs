let e;import t from"path";import r from"os";import n from"child_process";import{Readable as i}from"stream";import o from"http";import s from"net";import l from"zlib";import u from"util";import a from"fs";import c from"url";import f from"path";import d from"module";let p=c.fileURLToPath(import.meta.url),h=f.dirname(p);d.createRequire(import.meta.url);var m,g={exports:{}};Object.defineProperty(g.exports,"__esModule",{value:!0});let{round:y,floor:w,max:S}=Math,z=e=>{let[,t]=/([a-f\d]{3,6})/i.exec(e)||[],r=t?t.length:0;if(3===r)t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2];else if(6!==r)return[0,0,0];let n=parseInt(t,16);return[n>>16&255,n>>8&255,255&n]},b=(e,t,r)=>e===t&&t===r?e<8?16:e>248?231:y((e-8)/247*24)+232:16+36*y(e/51)+6*y(t/51)+y(r/51),x=e=>{let t,r,n,i,o,s;return e<8?30+e:e<16?e-8+90:(e>=232?t=r=n=(10*(e-232)+8)/255:(s=(e-=16)%36,t=w(e/36)/5,r=w(s/6)/5,n=s%6/5),0==(i=2*S(t,r,n))?30:(o=30+(y(n)<<2|y(r)<<1|y(t)),2===i?o+60:o))},_=(e,t,r)=>x(b(e,t,r)),v=(e=>{let t=e=>!!u.find(t=>e.test(t)),r=globalThis,n=r.Deno,i=null!=n,o=r.process||n||{},s=o.stdout,l="win32"===(i?n.build.os:o.platform),u=o.argv||o.args||[],a=o.env||{},c=-1;if(i)try{a=a.toObject()}catch(e){c=0}let f="FORCE_COLOR",d=a[f],p=parseInt(d),h="false"===d?0:isNaN(p)?3:p,m="NO_COLOR"in a||0===h||t(/^-{1,2}(no-color|color=(false|never))$/),g=f in a&&h||t(/^-{1,2}color=?(true|always)?$/),y=(a.NEXT_RUNTIME||"").indexOf("edge")>-1||"PM2_HOME"in a&&"pm_id"in a||(i?n.isatty(1):s&&"isTTY"in s);return m?0:(c<0&&(c=((e,t,r)=>{let{TERM:n,COLORTERM:i}=e;return"TF_BUILD"in e?1:"TEAMCITY_VERSION"in e?2:"CI"in e?["GITHUB_ACTIONS","GITEA_ACTIONS"].some(t=>t in e)?3:1:!t||/-mono|dumb/i.test(n)?0:r||"truecolor"===i||"24bit"===i||"xterm-kitty"===n?3:/-256(colou?r)?$/i.test(n)?2:/^screen|^tmux|^xterm|^vt[1-5][0-9]([0-9])?|^ansi|color|cygwin|linux|mintty|rxvt/i.test(n)?1:3})(a,y,l)),g&&0===c?3:c)})(),O=v>0,$={open:"",close:""},M=O?(e,t)=>({open:`[${e}m`,close:`[${t}m`}):()=>$,k=e=>(t,r,n)=>e(b(t,r,n)),E=e=>t=>{let[r,n,i]=z(t);return e(r,n,i)},C=e=>M(`38;5;${e}`,39),j=e=>M(`48;5;${e}`,49),I=(e,t,r)=>M(`38;2;${e};${t};${r}`,39),P=(e,t,r)=>M(`48;2;${e};${t};${r}`,49);1===v?(C=e=>M(x(e),39),j=e=>M(x(e)+10,49),I=(e,t,r)=>M(_(e,t,r),39),P=(e,t,r)=>M(_(e,t,r)+10,49)):2===v&&(I=k(C),P=k(j));let B,R,A={ansi256:C,bgAnsi256:j,fg:C,bg:j,rgb:I,bgRgb:P,hex:E(I),bgHex:E(P),visible:$,reset:M(0,0),inverse:M(7,27),hidden:M(8,28),bold:M(1,22),dim:M(2,22),italic:M(3,23),underline:M(4,24),strikethrough:M(9,29),strike:M(9,29),grey:M(90,39),gray:M(90,39),bgGrey:M(100,49),bgGray:M(100,49)},T="Bright",N=30;for(B of["black","red","green","yellow","blue","magenta","cyan","white"])R="bg"+B[0].toUpperCase()+B.slice(1),A[B]=M(N,39),A[B+T]=M(N+60,39),A[R]=M(N+10,49),A[R+T]=M(N+70,49),N++;let{defineProperty:L,defineProperties:D,setPrototypeOf:F}=Object,U=/[Â›][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/g,W=/(\r?\n)/g,G={},q=({_p:t},{open:r,close:n})=>{let i=(e,...t)=>{if(!e)return"";let r=i._p,{_a:n,_b:o}=r,s=null!=e.raw?String.raw(e,...t):""+e;if(s.includes("\x1b"))for(;null!=r;){let e=r.close,t=e.length;if(t){let n,i=0,o="";for(;~(n=s.indexOf(e,i));)o+=s.slice(i,n)+r.open,i=n+t;i&&(s=o+s.slice(i))}r=r._p}return s.includes("\n")&&(s=s.replace(W,o+"$1"+n)),n+s+o},o=r,s=n;return null!=t&&(o=t._a+r,s=n+t._b),F(i,e),i._p={open:r,close:n,_a:o,_b:s,_p:t},i.open=o,i.close=s,i},J=function(){let t=e=>""+e;return t.isSupported=()=>O,t.strip=e=>e.replace(U,""),t.extend=r=>{for(let e in r){let t=r[e],n=typeof t,i="string"===n?I(...z(t)):t;G[e]="function"===n?{get(){return(...e)=>q(this,t(...e))}}:{get(){let t=q(this,i);return L(this,e,{value:t}),t}}}F(t,e=D({},G))},t.extend(A),t},H=new J;g.exports=H,g.exports.Ansis=J;var K=(m=g.exports)&&m.__esModule&&Object.prototype.hasOwnProperty.call(m,"default")?m.default:m;let Y=a.promises,Z=new TextEncoder,V=new TextDecoder,X=u.promisify(l.gzip),Q={level:l.constants.Z_DEFAULT_LEVEL},ee=er(t.join(h,"client")),et=er(t.join(ee,"assets"));function er(e){return/^\\\\\?\\/.test(e)?e:e.replace(/\\/g,"/")}function en(e){return"string"==typeof e?Z.encode(e):e}async function ei(e){let r=await Promise.all((await Y.readdir(e)).map(r=>t.join(e,r))),n=0,i=[];for(;n!==r.length;){let e=r[n],o=await Y.stat(e);if(o.isDirectory()){let n=await Y.readdir(e);r.push(...n.map(r=>t.join(e,r)))}o.isFile()&&i.push(e),n++}return i}let eo=process.env.DEBUG||process.env.ANALYZE_DEBUG?(...e)=>{console.log(K.hex("#5B45DE")("[vite:bundle-analyzer]"),...e)}:()=>{};function es(e){let t="head"===e.injectTo?/([ \t]*)<\/head>/i:/([ \t]*)<\/body>/i;e.descriptors=Array.isArray(e.descriptors)?e.descriptors:[e.descriptors];let r=e.descriptors.map(e=>e.attrs&&e.attrs.length>0?`<${e.kind} ${e.attrs.join(" ")}>${e.text}</${e.kind}>`:`<${e.kind}>${e.text}</${e.kind}>`);return e.html.replace(t,e=>`${r.join("\n")}${e}`)}async function el(e,r){let n=await ei(et),i=(await Promise.all(n.map(async e=>({fileType:t.extname(e).replace(".",""),content:await Y.readFile(e,"utf8")})))).filter(e=>["js","css"].includes(e.fileType)),o=await Y.readFile(t.join(ee,"index.html"),"utf8");return o=es({html:o=(o=(o=o.replace(/<script\b[^>]*>[\s\S]*?<\/script>/gi,"")).replace(/<link\b[^>]*rel="stylesheet"[^>]*>/gi,"")).replace(/<title>(.*?)<\/title>/,`<title>${r.title}</title>`),injectTo:"head",descriptors:i.map(({fileType:e,content:t})=>({kind:"js"===e?"script":"style",text:t,attrs:"js"===e?['type="module"']:[]}))}),o=es({html:o,injectTo:"body",descriptors:{kind:"script",text:function(e,t){let{stringify:r}=JSON;return`var defaultSizes=${r(t)},analyzeModule=${r(e)};`}(e,r.mode)}})}async function eu(e){let t=()=>Math.floor(64512*Math.random())+1024,r=async e=>new Promise(t=>{let r=s.createServer();r.once("error",e=>{"EADDRINUSE"===e.code?t(!1):t(!0)}),r.once("listening",()=>{r.close(()=>{t(!0)})}),r.listen(e,"localhost")});if(0===e){let e=!1,n=0;for(;!e;)n=t(),e=await r(n);return n}let n=await r(e);if(n)return e;{let t=e+1;for(;;){if(n=await r(t))return t;t++}}}async function ea(e=0){let t=o.createServer(),r=await eu(e);return t.listen(r,()=>{console.log("server run on ",K.hex("#5B45DE")(`http://localhost:${r}`))}),{setup:e=>{t.on("request",function(t,r){"/"===t.url&&(r.setHeader("Content-Type","text/html; charset=utf8;"),r.setHeader("Content-Encoding","gzip"),e.arena.rs.pipe(l.createGzip()).pipe(r),e.arena.refresh())})},get port(){return r}}}let ec=["pnpm-workspace.yaml","lerna.json"];function ef(e,r=function e(r,n=r){if(function(e){let r=t.join(e,"package.json");return a.existsSync(r)}(r))return r;let i=t.dirname(r);return i&&i!==r?e(i,n):n}(e)){if(ec.some(r=>a.existsSync(t.join(e,r)))||function(e){let r=t.join(e,"package.json");if(!function(e){if(!function(e){try{return a.statSync(e,{throwIfNoEntry:!1})}catch{}}(e))return!1;try{return a.accessSync(e,a.constants.R_OK),!0}catch{return!1}}(r))return!1;try{return!!(JSON.parse(a.readFileSync(r,"utf-8"))||{}).workspaces}catch{return!1}}(e))return e;let n=t.dirname(e);return n&&n!==e?ef(n,r):r}class ed{kind;meta;filename;children;groups;isEndOfPath;constructor(e){this.kind=e?.kind||"stat",this.meta=e?.meta||{},this.filename=e?.filename||"",this.children=new Map,this.groups=[],this.isEndOfPath=!1}}class ep{root;constructor(e){this.root=new ed(e)}insert(e,t){let r=this.root,n=e.split("/").filter(Boolean),i="";for(let e of n)i=i?`${i}/${e}`:e,r.children.has(e)||r.children.set(e,new ed({...t})),(r=r.children.get(e)).filename=i;r.isEndOfPath=!0}mergePrefixSingleDirectory(e=this.root){for(let[t,r]of e.children.entries()){if(r.isEndOfPath)break;if(r.children.size>1){this.mergePrefixSingleDirectory(r);continue}for(let[n,i]of(e.children.delete(t),r.children.entries()))e.children.set(`${t}/${n}`,i),i.isEndOfPath||this.mergePrefixSingleDirectory(i)}}walk(e,t){if(e.children.size){for(let[r,n]of e.children.entries()){let i={...n.meta,label:r,groups:n.groups,filename:n.filename};if(n.isEndOfPath&&delete i.groups,t(i,e),this.walk(n,t),i.groups&&i.groups.length)switch(e.kind){case"stat":i.statSize=i.groups.reduce((e,t)=>e+t.statSize,0);break;case"source":{let e=i.groups.reduce((e,t)=>(e.parsedSize+=t.parsedSize,e.gzipSize+=t.gzipSize,e),{parsedSize:0,gzipSize:0});Object.assign(i,e)}}}e.children.clear()}}}let eh="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",em=new Uint8Array(64),eg=new Uint8Array(128);for(let e=0;e<eh.length;e++){let t=eh.charCodeAt(e);em[e]=t,eg[t]=e}let ey="undefined"!=typeof TextDecoder?new TextDecoder:"undefined"!=typeof Buffer?{decode:e=>Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString()}:{decode(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}};function ew(e,t,r,n){let i=0,o=0,s=0;do i|=(31&(s=eg[e.charCodeAt(t++)]))<<o,o+=5;while(32&s);let l=1&i;return i>>>=1,l&&(i=-2147483648|-i),r[n]+=i,t}function eS(e,t,r){return!(t>=r)&&44!==e.charCodeAt(t)}function ez(e,t){return e[0]-t[0]}function eb(e,t,r,n,i){let o=n[i],s=o-r[i];r[i]=o,s=s<0?-s<<1|1:s<<1;do{let r=31&s;(s>>>=5)>0&&(r|=32),e[t++]=em[r]}while(s>0);return t}let ex=/^[\w+.-]+:\/\//,e_=/^([\w+.-]+:)\/\/([^@/#?]*@)?([^:/#?]*)(:\d+)?(\/[^#?]*)?(\?[^#]*)?(#.*)?/,ev=/^file:(?:\/\/((?![a-z]:)[^/#?]*)?)?(\/?[^#?]*)(\?[^#]*)?(#.*)?/i;function eO(e){return e.startsWith("/")}function e$(e){return/^[.?#]/.test(e)}function eM(e){let t=e_.exec(e);return ek(t[1],t[2]||"",t[3],t[4]||"",t[5]||"/",t[6]||"",t[7]||"")}function ek(e,t,r,n,i,o,s){return{scheme:e,user:t,host:r,port:n,path:i,query:o,hash:s,type:7}}function eE(e){if(e.startsWith("//")){let t=eM("http:"+e);return t.scheme="",t.type=6,t}if(eO(e)){let t=eM("http://foo.com"+e);return t.scheme="",t.host="",t.type=5,t}if(e.startsWith("file:"))return function(e){let t=ev.exec(e),r=t[2];return ek("file:","",t[1]||"","",eO(r)?r:"/"+r,t[3]||"",t[4]||"")}(e);if(ex.test(e))return eM(e);let t=eM("http://foo.com/"+e);return t.scheme="",t.host="",t.type=e?e.startsWith("?")?3:e.startsWith("#")?2:4:1,t}function eC(e,t){let r=t<=4,n=e.path.split("/"),i=1,o=0,s=!1;for(let e=1;e<n.length;e++){let t=n[e];if(!t){s=!0;continue}if(s=!1,"."!==t){if(".."===t){o?(s=!0,o--,i--):r&&(n[i++]=t);continue}n[i++]=t,o++}}let l="";for(let e=1;e<i;e++)l+="/"+n[e];l&&(!s||l.endsWith("/.."))||(l+="/"),e.path=l}function ej(e,t){return t&&!t.endsWith("/")&&(t+="/"),function(e,t){if(!e&&!t)return"";let r=eE(e),n=r.type;if(t&&7!==n){let e=eE(t),i=e.type;switch(n){case 1:r.hash=e.hash;case 2:r.query=e.query;case 3:case 4:eC(e,e.type),"/"===r.path?r.path=e.path:r.path=function(e){if(e.endsWith("/.."))return e;let t=e.lastIndexOf("/");return e.slice(0,t+1)}(e.path)+r.path;case 5:r.user=e.user,r.host=e.host,r.port=e.port;case 6:r.scheme=e.scheme}i>n&&(n=i)}eC(r,n);let i=r.query+r.hash;switch(n){case 2:case 3:return i;case 4:{let n=r.path.slice(1);if(!n)return i||".";if(e$(t||e)&&!e$(n))return"./"+n+i;return n+i}case 5:return r.path+i;default:return r.scheme+"//"+r.user+r.host+r.port+r.path+i}}(e,t)}function eI(e,t){for(let r=t;r<e.length;r++)if(!function(e){for(let t=1;t<e.length;t++)if(e[t][0]<e[t-1][0])return!1;return!0}(e[r]))return r;return e.length}function eP(e,t){return e[0]-t[0]}let eB=!1;function eR(e,t,r){for(let n=r+1;n<e.length&&e[n][0]===t;r=n++);return r}function eA(e,t,r){for(let n=r-1;n>=0&&e[n][0]===t;r=n--);return r}function eT(){return{lastKey:-1,lastNeedle:-1,lastIndex:-1}}function eN(e,t,r,n){let{lastKey:i,lastNeedle:o,lastIndex:s}=r,l=0,u=e.length-1;if(n===i){if(t===o)return eB=-1!==s&&e[s][0]===t,s;t>=o?l=-1===s?0:s:u=s}return r.lastKey=n,r.lastNeedle=t,r.lastIndex=function(e,t,r,n){for(;r<=n;){let i=r+(n-r>>1),o=e[i][0]-t;if(0===o)return eB=!0,i;o<0?r=i+1:n=i-1}return eB=!1,r-1}(e,t,l,u)}function eL(){return{__proto__:null}}let eD=function(e,t){let r=eF(e);if(!("sections"in r))return new eq(r,t);let n=[],i=[],o=[],s=[],l=[];return function e(t,r,n,i,o,s,l,u,a,c,f){let{sections:d}=t;for(let t=0;t<d.length;t++){let{map:p,offset:h}=d[t],m=c,g=f;if(t+1<d.length){let e=d[t+1].offset;(m=Math.min(c,u+e.line))===c?g=Math.min(f,a+e.column):m<c&&(g=a+e.column)}!function(t,r,n,i,o,s,l,u,a,c,f){let d=eF(t);if("sections"in d)return e(...arguments);let p=new eq(d,r),h=i.length,m=s.length,g=eJ(p),{resolvedSources:y,sourcesContent:w,ignoreList:S}=p;if(eU(i,y),eU(s,p.names),w)eU(o,w);else for(let e=0;e<y.length;e++)o.push(null);if(S)for(let e=0;e<S.length;e++)l.push(S[e]+h);for(let e=0;e<g.length;e++){let t=u+e;if(t>c)return;let r=function(e,t){for(let r=e.length;r<=t;r++)e[r]=[];return e[t]}(n,t),i=0===e?a:0,o=g[e];for(let e=0;e<o.length;e++){let n=o[e],s=i+n[0];if(t===c&&s>=f)return;if(1===n.length){r.push([s]);continue}let l=h+n[1],u=n[2],a=n[3];r.push(4===n.length?[s,l,u,a]:[s,l,u,a,m+n[4]])}}}(p,r,n,i,o,s,l,u+h.line,a+h.column,m,g)}}(r,t,n,i,o,s,l,0,0,1/0,1/0),function(e,t){var r;let n=new eq((r=[],{version:e.version,file:e.file,names:e.names,sourceRoot:e.sourceRoot,sources:e.sources,sourcesContent:e.sourcesContent,mappings:r,ignoreList:e.ignoreList||e.x_google_ignoreList}),void 0);return n._decoded=e.mappings,n}({version:3,file:r.file,names:s,sources:i,sourcesContent:o,mappings:n,ignoreList:l})};function eF(e){return"string"==typeof e?JSON.parse(e):e}function eU(e,t){for(let r=0;r<t.length;r++)e.push(t[r])}let eW="`line` must be greater than 0 (lines start at line 1)",eG="`column` must be greater than or equal to 0 (columns start at column 0)";class eq{constructor(e,t){let r="string"==typeof e;if(!r&&e._decodedMemo)return e;let n=r?JSON.parse(e):e,{version:i,file:o,names:s,sourceRoot:l,sources:u,sourcesContent:a}=n;this.version=i,this.file=o,this.names=s||[],this.sourceRoot=l,this.sources=u,this.sourcesContent=a,this.ignoreList=n.ignoreList||n.x_google_ignoreList||void 0;let c=ej(l||"",function(e){if(!e)return"";let t=e.lastIndexOf("/");return e.slice(0,t+1)}(t));this.resolvedSources=u.map(e=>ej(e||"",c));let{mappings:f}=n;"string"==typeof f?(this._encoded=f,this._decoded=void 0):(this._encoded=void 0,this._decoded=function(e,t){let r=eI(e,0);if(r===e.length)return e;t||(e=e.slice());for(let i=r;i<e.length;i=eI(e,i+1)){var n;e[i]=(n=e[i],t||(n=n.slice()),n.sort(eP))}return e}(f,r)),this._decodedMemo=eT(),this._bySources=void 0,this._bySourceMemos=void 0}}function eJ(e){return e._decoded||(e._decoded=function(e){let t=new Int32Array(5),r=[],n=0;do{let i=function(e,t){let r=e.indexOf(";",t);return -1===r?e.length:r}(e,n),o=[],s=!0,l=0;t[0]=0;for(let r=n;r<i;r++){let n;r=ew(e,r,t,0);let u=t[0];u<l&&(s=!1),l=u,eS(e,r,i)?(r=ew(e,r,t,1),r=ew(e,r,t,2),r=ew(e,r,t,3),eS(e,r,i)?(r=ew(e,r,t,4),n=[u,t[1],t[2],t[3],t[4]]):n=[u,t[1],t[2],t[3]]):n=[u],o.push(n)}s||function(e){e.sort(ez)}(o),r.push(o),n=i+1}while(n<=e.length);return r}(e._encoded))}function eH(e,t,r,n){return{source:e,line:t,column:r,name:n}}function eK(e,t){return{line:e,column:t}}function eY(e,t,r,n,i){let o=eN(e,n,t,r);return(eB?o=(-1===i?eR:eA)(e,n,o):-1===i&&o++,-1===o||o===e.length)?-1:o}function eZ(e,t,r,n,i,o){if(--r<0)throw Error(eW);if(n<0)throw Error(eG);let{sources:s,resolvedSources:l}=e,u=s.indexOf(t);if(-1===u&&(u=l.indexOf(t)),-1===u)return o?[]:eK(null,null);let a=(e._bySources||(e._bySources=function(e,t){let r=t.map(eL);for(let n=0;n<e.length;n++){let i=e[n];for(let e=0;e<i.length;e++){let o=i[e];if(1===o.length)continue;let s=o[1],l=o[2],u=o[3],a=r[s],c=a[l]||(a[l]=[]),f=t[s],d=eR(c,u,eN(c,u,f,l));f.lastIndex=++d,function(e,t,r){for(let r=e.length;r>t;r--)e[r]=e[r-1];e[t]=r}(c,d,[u,n,o[0]])}}return r}(eJ(e),e._bySourceMemos=s.map(eT))))[u][r];if(null==a)return o?[]:eK(null,null);let c=e._bySourceMemos[u];if(o)return function(e,t,r,n,i){let o=eY(e,t,r,n,1);if(!eB&&-1===i&&o++,-1===o||o===e.length)return[];let s=eB?n:e[o][0];eB||(o=eA(e,s,o));let l=eR(e,s,o),u=[];for(;o<=l;o++){let t=e[o];u.push(eK(t[1]+1,t[2]))}return u}(a,c,r,n,i);let f=eY(a,c,r,n,i);if(-1===f)return eK(null,null);let d=a[f];return eK(d[1]+1,d[2])}class eV{constructor(e,t){let r=this._map=new eD(e,t);this.file=r.file,this.names=r.names,this.sourceRoot=r.sourceRoot,this.sources=r.resolvedSources,this.sourcesContent=r.sourcesContent,this.version=r.version}static fromSourceMap(e,t){return e.toDecodedMap?new eV(e.toDecodedMap(),t):new eV(e.toJSON(),t)}get mappings(){var e,t;return null!==(t=(e=this._map)._encoded)&&void 0!==t?t:e._encoded=function(e){let t=new Int32Array(5),r=new Uint8Array(16384),n=r.subarray(0,16348),i=0,o="";for(let s=0;s<e.length;s++){let l=e[s];if(s>0&&(16384===i&&(o+=ey.decode(r),i=0),r[i++]=59),0!==l.length){t[0]=0;for(let e=0;e<l.length;e++){let s=l[e];i>16348&&(o+=ey.decode(n),r.copyWithin(0,16348,i),i-=16348),e>0&&(r[i++]=44),i=eb(r,i,t,s,0),1!==s.length&&(i=eb(r,i,t,s,1),i=eb(r,i,t,s,2),i=eb(r,i,t,s,3),4!==s.length&&(i=eb(r,i,t,s,4)))}}}return o+ey.decode(r.subarray(0,i))}(e._decoded)}originalPositionFor(e){return function(e,t){let{line:r,column:n,bias:i}=t;if(--r<0)throw Error(eW);if(n<0)throw Error(eG);let o=eJ(e);if(r>=o.length)return eH(null,null,null,null);let s=o[r],l=eY(s,e._decodedMemo,r,n,i||1);if(-1===l)return eH(null,null,null,null);let u=s[l];if(1===u.length)return eH(null,null,null,null);let{names:a,resolvedSources:c}=e;return eH(c[u[1]],u[2]+1,u[3],5===u.length?a[u[4]]:null)}(this._map,e)}generatedPositionFor(e){return function(e,t){let{source:r,line:n,column:i,bias:o}=t;return eZ(e,r,n,i,o||1,!1)}(this._map,e)}allGeneratedPositionsFor(e){return function(e,t){let{source:r,line:n,column:i,bias:o}=t;return eZ(e,r,n,i,o||-1,!0)}(this._map,e)}hasContentsOfAllSources(){if(!this.sourcesContent||this.sourcesContent.length!==this.sources.length)return!1;for(let e of this.sourcesContent)if(null==e)return!1;return!0}sourceContentFor(e,t){let r=function(e,t){let{sourcesContent:r}=e;if(null==r)return null;let n=function(e,t){let{sources:r,resolvedSources:n}=e,i=r.indexOf(t);return -1===i&&(i=n.indexOf(t)),i}(e,t);return -1===n?null:r[n]}(this._map,e);if(null!=r)return r;if(t)return null;throw Error(`"${e}" is not in the SourceMap.`)}eachMapping(e,t){!function(e,t){let r=eJ(e),{names:n,resolvedSources:i}=e;for(let e=0;e<r.length;e++){let o=r[e];for(let r=0;r<o.length;r++){let s=o[r],l=e+1,u=s[0],a=null,c=null,f=null,d=null;1!==s.length&&(a=i[s[1]],c=s[2]+1,f=s[3]),5===s.length&&(d=n[s[4]]),t({generatedLine:l,generatedColumn:u,source:a,originalLine:c,originalColumn:f,name:d})}}}(this._map,t?e.bind(t):e)}destroy(){}}class eX extends eV{constructor(e){super(JSON.parse(e),"")}}let eQ=[".mjs",".js",".cjs",".ts",".tsx",".vue",".svelte",".md",".mdx"],e0=process.cwd();function e1(e,r=e0){let n=function(e,t=e0){return(e=er(e)).replace(t,"").replace(/\0/,"")}(e,r);return t.isAbsolute(n)?n.replace("/",""):n}function e2(e,t,r){eo(`[${e}]: ${K.yellow(t)} find ${K.bold(K.green(r+""))} relative modules.`)}class e3{originalId;filename;label;parsedSize;mapSize;statSize;gzipSize;source;stats;imports;isAsset;isEntry;constructor(e){this.originalId=e,this.filename=e,this.label=e,this.parsedSize=0,this.statSize=0,this.gzipSize=0,this.mapSize=0,this.source=[],this.stats=[],this.imports=new Set,this.isAsset=!0,this.isEntry=!1}addImports(...e){e.forEach(e=>this.imports.add(e))}async setup(e,r,n,i){let{imports:o,dynamicImports:s,map:l,moduleIds:u}=e;this.addImports(...o,...s),this.mapSize=l.length,this.isEntry=e.isEntry;let a=u.length?u.reduce((e,n)=>{let i=r.getModuleInfo(n);return i&&i.code&&(eQ.includes(t.extname(i.id))||i.id.startsWith("\0"))&&e.push({id:i.id,code:i.code}),e},[]):function(e){let t=new eX(e),r=t.sources.reduce((e,r)=>{if(r){let n=t.sourceContentFor(r,!0);n&&e.push({id:r,code:n})}return e},[]);return t.destroy(),r}(l),c=new ep({meta:{statSize:0}}),f=new ep({kind:"source",meta:{gzipSize:0,parsedSize:0}});for(let e of a){"."===e.id[0]&&(e.id=t.resolve(i,e.id));let r=en(e.code).byteLength;this.statSize+=r,c.insert(e1(e.id,i),{kind:"stat",meta:{statSize:r}})}e2("stats",this.originalId,a.length);let{grouped:d,files:p}=function(e,t,r){let n=new eX(t),i={},o=new Set,s=1,l=0,u="string"==typeof e?e:V.decode(e);for(let e=0;e<u.length;e++,l++){let{source:t}=n.originalPositionFor({line:s,column:l});if(null!=t){let n=r(t),s=u[e];n in i||(i[n]=""),i[n]+=s,o.add(n)}"\n"===u[e]&&(s+=1,l=-1)}return n.destroy(),{grouped:i,files:o}}(e.code,l,e=>{let r=t.relative(i,e);return t.join(i,r)});for(let r in p.size||(d[this.originalId]=e.code,p.add(this.originalId)),d){if(!eQ.includes(t.extname(r)))continue;let e=en(d[r]),{byteLength:o}=await n(e),s=e.byteLength;f.insert(e1(r,i),{kind:"source",meta:{gzipSize:o,parsedSize:s}})}for(let e of(e2("source",this.originalId,p.size),c.mergePrefixSingleDirectory(),c.walk(c.root,(e,t)=>t.groups.push(e)),f.mergePrefixSingleDirectory(),f.walk(f.root,(e,t)=>t.groups.push(e)),this.stats=c.root.groups,this.source=f.root.groups,this.source))this.gzipSize+=e.gzipSize,this.parsedSize+=e.parsedSize}}class e4{compress;modules;workspaceRoot;pluginContext;chunks;constructor(e){this.compress=function(e={}){return e=Object.assign(Q,e),t=>X(t,e)}(e),this.modules=[],this.pluginContext=null,this.chunks={},this.workspaceRoot=process.cwd()}installPluginContext(e){this.pluginContext||(this.pluginContext=e)}setupRollupChunks(e){this.chunks=e}async addModule(e,t){let r=function(e,t,r){let n={},i="chunk"===e.type;return n.code=en(i?e.code:e.source),n.map=r?function(e,t,r){if(t in r)return r[t].source;throw Error(`[analyzer error]: Missing sourcemap for ${e}.`)}(e.fileName,r,t):i?e.map?.toString():"",n.imports=i?e.imports:[],n.dynamicImports=i?e.dynamicImports:[],n.moduleIds=i?Object.keys(e.modules):[],n.filename=e.fileName,n.isEntry=!!i&&e.isEntry,n}(e,this.chunks,t),n=new e3(r.filename);await n.setup(r,this.pluginContext,this.compress,this.workspaceRoot),this.modules.push(n)}processModule(){return this.modules.map(e=>{let{originalId:t,imports:r,...n}=e;return{...n,imports:[...r]}})}}function e5(e){let t=["name","generateBundle","closeBundle","api"].reduce((t,r)=>(t[r]=e[r],t),{}),r=process.cwd(),{store:n}=t.api;return{...t,outputOptions(e){if(!n.hasSetSourcemapOption)return e.dir&&(r=e.dir),n.analyzerModule.workspaceRoot=ef(r),"sourcemap"in e&&(n.previousSourcemapOption="boolean"==typeof e.sourcemap?e.sourcemap:"hidden"===e.sourcemap),"boolean"==typeof e.sourcemap&&e.sourcemap?e.sourcemap=!0:e.sourcemap="hidden",e}}}let e8=!!process.env.CI,e6={analyzerMode:"server",defaultSizes:"stat",summary:!0},e9=e=>K.dim(K.bold(e+"")),e7=e=>e9(function(e){if(!e)return"0 Bytes";let t=parseInt(`${Math.floor(Math.log(e)/Math.log(1024))}`);return(e/(1<<10*t)).toFixed(2)+" "+["Bytes","KB","MB","GB","TB"][t]}(e)),te=e=>{let t=e.length,r=e.reduce((e,t)=>(e.gzip+=t.gzipSize,e.parsed+=t.parsedSize,e.map+=t.mapSize,e),{gzip:0,parsed:0,map:0}),n=[r.gzip&&`gzip: ${e7(r.gzip)}`,r.map&&`map: ${e7(r.map)}`].filter(Boolean).join(" | ");return`${e9(t)} chunks of ${e7(r.parsed)} ${n?`(${n})`:""}`};function tt(e){let o,s,l;let{reportTitle:u="vite-bundle-analyzer"}=e={...e6,...e},a=new e4(e?.gzipOptions),c={previousSourcemapOption:!1,hasSetSourcemapOption:!1,analyzerModule:a},f=process.cwd(),d=!0,p=process.cwd(),h="server"===e.analyzerMode||"static"===e.analyzerMode,m="json"===e.analyzerMode||"static"===e.analyzerMode,g=(l=!1,{rs:new i,into(e){l||(this.rs.push(e),this.rs.push(null),s||(s=en(e)),l=!0)},refresh(){l=!1,this.rs=new i,this.into(s)}});return{name:"vite-bundle-anlyzer",apply:"build",enforce:"post",api:{store:c},configResolved(r){if(f=t.resolve(r.root,r.build.outDir??""),o=r.logger,p=ef(r.root),a.workspaceRoot=p,e.summary){let e=r.plugins.find(e=>"vite:reporter"===e.name);if(d=!!e?.writeBundle,e?.writeBundle){let t="function"==typeof e.writeBundle?e.writeBundle:e.writeBundle?.handler,r=async function(...e){await t?.apply(this,e),o.info(te(a.modules))};"function"!=typeof e.writeBundle?e.writeBundle.handler=r:e.writeBundle=r}}c.hasSetSourcemapOption||(c.hasSetSourcemapOption=!0,r.build?.sourcemap&&(c.previousSourcemapOption="boolean"==typeof r.build.sourcemap?r.build.sourcemap:"hidden"===r.build.sourcemap),"boolean"==typeof r.build.sourcemap&&r.build.sourcemap?r.build.sourcemap=!0:r.build.sourcemap="hidden",eo(`plugin status is ${r.build.sourcemap?K.green("ok"):K.red("invalid")}`))},async generateBundle(e,r){for(let e in a.installPluginContext(this),a.setupRollupChunks(r),r){let n=r[e],[i,o]=function(e,r){var n;if(n=e.fileName,".js"===t.extname(n)){let t=e.fileName+".map";return t in r?[!0,t]:[!0,void 0]}return[!1,void 0]}(n,r);if(i&&await a.addModule(n,o),!c.previousSourcemapOption&&i){if(o){Reflect.deleteProperty(r,o);continue}"chunk"===n.type&&Reflect.deleteProperty(n,"map")}}},async closeBundle(){e.summary&&!d&&o.info(te(a.modules));let i=a.processModule();if(m){let r="fileName"in e?e.fileName:"stats",n=t.join(f,`${r}.${"json"===e.analyzerMode?"json":"html"}`);if("json"===e.analyzerMode)return Y.writeFile(n,JSON.stringify(i,null,2),"utf8");let o=await el(i,{title:u,mode:e.defaultSizes||"stat"});if(Y.writeFile(n,o,"utf8"),g.into(o),"static"===e.analyzerMode&&!e.openAnalyzer)return}if(h){let t=await el(i,{title:u,mode:e.defaultSizes||"stat"});g.into(t);let{setup:o,port:s}=await ea("analyzerPort"in e?"auto"===e.analyzerPort?0:e.analyzerPort:8888);o({title:u,mode:"stat",arena:g}),"openAnalyzer"in e&&!e.openAnalyzer||e8||function(e){let[t,i]=function(e){switch(e){case"linux":if(-1!==r.release().toLocaleLowerCase().indexOf("microsoft"))return["win32","cmd.exe"];return["linux","xdg-open"];case"win32":return["win32","cmd.exe"];case"darwin":return["darwin","open"];default:return[e,"xdg-open"]}}(r.platform());"win32"===t&&(e=["/c","start",'""'].concat(e=e.map(e=>e.replace(/[&^]/g,"^$&")))),n.spawn(i,e)}([`http://localhost:${s}`])}}}}export{e5 as adapter,tt as analyzer,tt as default};
